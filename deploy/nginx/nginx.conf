# events {}

# http {
  # upstream django_upstream { server web:8000; }
  # upstream rasa_upstream   { server rasa:5005; }

  # server {
    # listen 80;

    # location /static/ { alias /static/; }
    # location /media/  { alias /media/; }

    # location / {
      # proxy_pass http://django_upstream;
      # proxy_set_header Host $host;
      # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      # proxy_set_header X-Forwarded-Proto $scheme;
    # }

    # location /rasa/ {
      # rewrite ^/rasa/(.*)$ /$1 break;
      # proxy_pass http://rasa_upstream;
      # proxy_set_header Host $host;
      # proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      # proxy_set_header X-Forwarded-Proto $scheme;
    # }
  # }
# }

events {}

http {
  include /etc/nginx/mime.types;
  default_type application/octet-stream;

  upstream django {
    server web:8000;
  }

  upstream rasa_upstream {
    server rasa:5005;
  }

  server {
    listen 80;

    client_max_body_size 50M;

    location /static/ {
      alias /static/;
      expires 7d;
    }

    location /media/ {
      alias /media/;
      expires 7d;
    }

    # If you serve rag pdfs directly:
    location /rag_pdfs/ {
      alias /data/rag/rag_pdfs/;
	  expires 7d;
    }

    location / {
      proxy_pass http://django;
      proxy_set_header Host $host;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }

    # If you want /rasa/* forwarded
    location /rasa/ {
      proxy_pass http://rasa_upstream/;
      proxy_set_header Host $host;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
    }
  }
}